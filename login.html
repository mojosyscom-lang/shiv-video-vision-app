<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>Login - Shiv Video Vision</title>

  <!-- Safe-area / status bar color -->
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <link rel="stylesheet" href="css/style.css?v=15">
  <link rel="stylesheet" href="css/dark.css?v=15">

  <style>
    html, body { height:100%; margin:0; background:#ffffff; }

    body.no-scroll { overflow:hidden; }

    .loginPage{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:
        calc(env(safe-area-inset-top) + 24px)
        16px
        calc(env(safe-area-inset-bottom) + 24px);
      background:#ffffff;
      overflow:hidden;
    }

    .loginBg{
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(circle at 20% 15%, rgba(255,0,140,.10), transparent 45%),
        radial-gradient(circle at 85% 25%, rgba(255,190,0,.10), transparent 45%),
        radial-gradient(circle at 50% 85%, rgba(0,170,255,.10), transparent 55%);
      pointer-events:none;
    }

    .loginCard{
      position:relative;
      width:min(420px, 92vw);
      background:#ffffff;
      border:1px solid #eee;
      border-radius:18px;
      padding:20px;
      box-shadow:0 18px 60px rgba(0,0,0,.10);
    }

    .loginTop{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }

    .loginTop img{ height:34px; width:auto; }

    .loginTitle{
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .loginTitle strong{ font-size:16px; letter-spacing:.02em; }
    .loginTitle span{ font-size:12px; color:#666; margin-top:2px; }

    .field{ margin-top:12px; }
    .field label{
      display:block;
      font-size:12px;
      color:#666;
      margin-bottom:6px;
    }

    .field input{
      width:100%;
      box-sizing:border-box;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid #e6e6e6;
      font-size:15px;
      outline:none;
      background:#fff;
    }

    .loginActions{ margin-top:16px; }

    .loginBtn{
      width:100%;
      padding:12px 14px;
      border:0;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      font-size:15px;
      background:#111;
      color:#fff;
    }

    .loginBtn:disabled{
      opacity:.65;
      cursor:not-allowed;
    }

    .netMini{
      font-size:12px;
      color:#777;
      margin-top:10px;
      text-align:center;
    }

    /* Dark mode safe-area match */
    body.dark, body.dark .loginPage { background:#0f1115; }
    body.dark .loginCard{
      background:#1a1d24;
      border:1px solid #262a34;
      box-shadow:none;
    }
    body.dark .loginTitle span,
    body.dark .field label,
    body.dark .netMini{ color:#aaa; }
    body.dark .field input{
      background:#111;
      color:#fff;
      border:1px solid #333;
    }
    body.dark .loginBtn{ background:#2b2f3a; }
  </style>
</head>

<body class="no-scroll">
  <div class="loginPage">
    <div class="loginBg"></div>

    <div class="loginCard">
      <div class="loginTop">
        <img src="assets/logo.png" alt="Shiv Video Vision">
        <div class="loginTitle">
          <strong>Shiv Video Vision</strong>
          <span>Sign in to continue</span>
        </div>
      </div>

      <div class="field">
        <label for="user">Username</label>
        <input id="user" autocomplete="username" placeholder="Enter username">
      </div>

      <div class="field">
        <label for="pass">Password</label>
        <input id="pass" type="password" autocomplete="current-password" placeholder="Enter password">
      </div>

      <div class="loginActions">
        <button class="loginBtn" id="btnLogin" onclick="login()">Login</button>
      </div>

      <div class="netMini" id="netStatusLogin"></div>
    </div>
  </div>

  <script src="js/nozoom.js?v=16"></script>
  <script src="js/api.js?v=15"></script>
  <script src="js/auth.js?v=15"></script>

  <script>
    // Apply saved theme instantly + match status bar color
    (function(){
      try{
        const t = localStorage.getItem("theme") || "light";
        document.body.classList.toggle("dark", t === "dark");
        const meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute("content", t === "dark" ? "#0f1115" : "#ffffff");
      }catch(e){}
    })();

    // Online indicator
    function updateNetLogin(){
      const el = document.getElementById("netStatusLogin");
      if (!el) return;
      el.textContent = navigator.onLine ? "ðŸŸ¢ Online" : "ðŸ”´ Offline (login requires internet)";
    }
    window.addEventListener("online", updateNetLogin);
    window.addEventListener("offline", updateNetLogin);
    updateNetLogin();

    // Enter key submits (calls login())
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") login();
    });

    // ---- Button lock wrapper (NO auth.js change) ----
    // This wraps the existing login() from auth.js and prevents double clicks.
    (function(){
      const originalLogin = window.login;
      if (typeof originalLogin !== "function") return;

      let inProgress = false;

      window.login = function(){
        if (inProgress) return;
        inProgress = true;

        const btn = document.getElementById("btnLogin");
        const originalText = btn ? (btn.innerText || "Login") : "Login";

        if (btn) {
          btn.disabled = true;
          btn.innerText = "Signing in...";
          btn.style.opacity = "0.7";
          btn.style.cursor = "not-allowed";
        }

        // Call original login()
        // If it redirects, this page unloads so no need to unlock.
        Promise.resolve(originalLogin())
          .catch((err) => {
            console.error("Login wrapper error:", err);
          })
          .finally(() => {
            // If still on login page after some time, unlock (means login failed)
            setTimeout(() => {
              if (location.pathname.toLowerCase().includes("login")) {
                inProgress = false;
                if (btn) {
                  btn.disabled = false;
                  btn.innerText = originalText;
                  btn.style.opacity = "";
                  btn.style.cursor = "";
                }
              }
            }, 8000);
          });
      };
    })();
  </script>
</body>
</html>