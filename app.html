<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Shiv Video Vision</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Shiv Video">

  <link rel="stylesheet" href="css/style.css?v=31">
  <link rel="stylesheet" href="css/dark.css?v=31">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* HEADER (kept here so it matches safe-area on all devices) */
    .appHeader{
      display:flex;
      align-items:center;
      gap:10px;
      padding:
        calc(env(safe-area-inset-top) + 10px)
        12px
        10px;
      background:#ffffff;
      border-bottom:1px solid #eee;
    }
    body.dark .appHeader{
      background:#0f1115;
      border-bottom:1px solid #222;
    }

    /* Overlay */
    .drawerOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(2px);
      -webkit-backdrop-filter:blur(2px);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      z-index:9999;
    }
    .drawerOverlay.open{
      opacity:1;
      pointer-events:auto;
    }

    /* Drawer header */
    .drawerHeader{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:16px;
    }
    .drawerHeader img{ height:28px; }

    /* Drawer section titles */
    .drawer h4{
      margin:14px 0 6px;
      padding:8px 6px;
      color:#aaa;
      font-size:12px;
      letter-spacing:.08em;
    }

    /* Drawer buttons */
    .drawer button{
      width:100%;
      text-align:left;
      background:transparent;
      border:0;
      color:#fff;
      padding:12px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:15px;
    }
    .drawer button:hover{
      background:rgba(255,255,255,.12);
    }
  </style>
</head>

<body class="no-scroll">
<div class="appShell safe">

  <!-- Overlay + Drawer (used on ALL devices now) -->
  <div id="drawerOverlay" class="drawerOverlay"></div>

  <aside id="drawer" class="drawer">
    <div class="drawerHeader">
      <img src="assets/logo.png" alt="SVV">
      <strong>Menu</strong>
    </div>

    <button onclick="navTo('dashboard'); closeDrawer()">ğŸ  Dashboard</button>

    <h4>ACCOUNTING</h4>
    <button onclick="navTo('upad'); closeDrawer()">ğŸ‘· Upad</button>
    <button onclick="navTo('expenses'); closeDrawer()">ğŸ“’ Expenses</button>
    <button onclick="navTo('salary'); closeDrawer()">ğŸ’° Salary</button>

    <h4>INVOICE</h4>
    <button onclick="navTo('invoice'); closeDrawer()">ğŸ§¾ Create Invoice</button>

    <div class="superadminOnly">
      <h4>ADMIN</h4>
      <button onclick="navTo('userMgmt'); closeDrawer()">ğŸ›¡ User Management</button>
      <button onclick="navTo('gst'); closeDrawer()">ğŸ“Š GST</button>
      <button onclick="navTo('export'); closeDrawer()">ğŸ“¤ Export</button>
    </div>

    <button onclick="logout()" style="margin-top:18px;">ğŸšª Logout</button>
  </aside>

  <!-- Header -->
  <header class="appHeader">
    <img src="assets/logo.png" height="30" alt="SVV">
    <strong>Shiv Video Vision</strong>

    <div style="margin-left:auto;display:flex;gap:10px;align-items:center;">
      <span id="netStatus" style="font-size:12px;"></span>
      <span id="syncCount" style="font-size:12px;"></span>
      <button class="iconBtn" onclick="toggleTheme()" title="Theme">ğŸŒ™</button>
      <button class="iconBtn menuBtn" id="btnMenu" title="Menu"></button>
    </div>
  </header>

  <!-- Single content host (same for all devices) -->
  <main class="appMain">
    <div id="content"></div>
  </main>

</div>

<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script src="js/sync.js"></script>
<script src="js/accounting.js"></script>
<script src="js/nozoom.js?v=1"></script>

<script>
  /* Drawer controls */
  const drawer = document.getElementById("drawer");
  const overlay = document.getElementById("drawerOverlay");

  function openDrawer(){
    drawer.classList.add("open");
    overlay.classList.add("open");
  }
  function closeDrawer(){
    drawer.classList.remove("open");
    overlay.classList.remove("open");
  }

  // force closed at load
  closeDrawer();

  document.getElementById("btnMenu")?.addEventListener("click", openDrawer);
  overlay?.addEventListener("click", closeDrawer);

  /* NAV STACK */
  window.__navStack = window.__navStack || ["dashboard"];

  window.navTo = async function(section){
    window.__navStack.push(section);
    section === "dashboard" ? showDashboard() : loadSection(section);
  };
</script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(console.error);
    });
  }
</script>

</body>
</html>